---
title: Здраво свете!
slug: здраво-свете
created: 2014-09-21
tags: хакел, хаскел
---

### Здраво!

Ових дана само најкул људи користе статичне генераторе за њихове сајтове. И пошто јако желим да будем кул и ја, ево решио сам да почнем и ја да их користим.

Искрено речено, нешто слично сам користио у прошлости. Неко страшно и неосвештно решење које укључујући лаганог Питон веб фрејмворка и обичне фајлове у Маркдауну, заједно производило снимак сајта који сам онда аплодавао. Када сам престао са дрогирањем, одлучио сам да тражим нешто што је било мало више разумно.

Нажалост, нисам нашао ништа тако. Заправо нешто горе се десило. Док сам тражио решење, функционална чистоћа ме је обузела, и не постоји ништа горе што штети душвено здравље.

Решио сам да пробам [Хакел](http://jaspervdj.be/hakyll/), који је статичан генератор за сајтове написам у Хаскелу, који је чист функционални језик за програмирање. Нисам нешто много користио Хаскела, али морао сам да га научим да конфигуришем [ИКСмонад](http://xmonad.org/) некада давно. Па зашто онда да га не користим на свој блог? Зашто да га не користим за све? Све мора да буде чисто!

Ово је само веома кратак преглед свог сајта. Ако сте се играли са статчним генераторе за сајтобе, онда нема ништа ново овде за вас. После кратког прегледа, показаћу вам како сам решио локализацио, што није баш једноставно ако вам је цео сајт статичан.


### Обичан статичан сајт

Океј! Једноставне ствари прво. Сваки блог пост је обичан фајл који садржава само текст у Маркдаун формату. Нешто типа овако:

``` markdown
---
title: Здраво свете!
tags: здраво, било шта
---

# Здраво свете!

...итд.

```

Горњи део који је између `---` блокиће је за метадату. Овде можемо буквално да ставимо шта год желимо. Све остало је стандардан Маркдаун. Хакл користи [Пандок](http://freecode.com/projects/pandoc) за рашчлањивање Маркдауна, што значи да уствари имамо надскуп функционалноста Маркдауна. По мени, све што Пандок додатно пружа прави га да има [најбољег верзију Маркдауна](http://johnmacfarlane.net/pandoc/demo/example9/pandocs-markdown.html) на интернету.

Маркдаун није ни неопходан! Пандок је C-3PO у свет рашчлањивања, тако да можемо било који формат да му дамо и он ће радо да нам избаци правилан HTML. И пошто је C-3PO може и чак Бачи да разуме. 

Сад кад имамо колекцију блог постова, била би добра идеја да нешто урадимо с њима.

``` haskell
main :: IO ()
main = hakyll $ do

    match "images/*" $ do
        route   idRoute
        compile copyFileCompiler

    match "css/*" $ do
        route   idRoute
        compile compressCssCompiler

    match "posts/*" $ do
        route   idRoute
        compile getResourceBody
```

Иако не разуме Хаскел, ипак можете да расјасните шта се овде дешава.

И наравно, шаблоне се раде исто преко Пандока. На пример, блог пост који смо написали ће наћи себе нагуран у ```$body$``` доле.

``` html
  ...
  <body>
    <div id="content">
      $body$
    </div>
  </body>
  ...
```

Има још пар ствари које повежују све заједно да бисмо имали сајт који ради, и можете читати више о томе [овде](http://jaspervdj.be/hakyll/tutorials/04-compilers.html). Ово је само намеравано да буде кратак преглед за неке основне ствари, али ћу можда једног дана написати неко боље упутство.

...И тако! Елегантно режење које ми даје да се усредсредим на писање уместо дрндање подешавања.


### Више од једног (људског) језика

Откад сам почео да бринем о функционалној пистоћи утврдили смо да нису ми баш све овце на броју. Што значи да волим да правим проблеме за себе. Имам потпуно луд сан где бих водио исти овај блог али *потпуно локализован* у сваки језик који говорим. 

...и хоћу да знам много језика.

Хвала Богу да само говорим два за сада: српски и енглески. Тако да, овако сам решио овај проблем, сваки случај ако има још неко што мисли да водити исти статичан блог у различитим језика је добра идеја. И као сваки добар пост који помењује Хаскел...!

Пребацили смо се на монадима.

Али прво, морамо да утврдимо да смо сви на истој страници. Прво, компилирамо наш код да добијемо наш програм:

``` bash
    $ ghc --make site.hs
```

И онда га покренемо да нам изгради сајт:

``` bash
    $ ./site build
```

Ово нам избаци цео извршен сајт у фасциклу која се уобичајено зове `_site`. Једино што нам је остало је да покренемо веб сервер и да му кажемо да служи сајт из те фасцикле. Једноставно, зар не? Како да није! Ово је лепоте статичне генерације.

Међутим, ајде да кажемо да нам се нешто пише на енглеском, и да смо решили да ћемо следећи блог пост да пишемо на енглеском. Нема проблема! Напишемо га и опет покренемо `./site build` и уживамо. И сада на нашем блогу имамо постове на српском и на енглеском. Сјајно. Мада није било потребно јер цео свет разуме српски али ајде ми смо светски људи. 

И за многе људе, ово би било прихватљиво решење. Али, чини ми се да сам рекао да смо хтели *потпуно локализован* сајт, што значи да и интерфејс треба да буде енглески.

Опет, нема проблема. Додаћемо варијаблу која описује који језик треба да користимо за ту страницу:

``` markdown
---
title: Howdy folks!
language: en
---
```

И у шаблонима, на основу овога можемо да покажемо исправан језик: 

``` html
  ...
  <a href="/">
    $if(en)$ Home $endif$
    $if(sr)$ Почетна $endif$
  </a>
  ...
```

Све је решено, зар не?

Па није баш. Кад сам рекао *потпуно локализовање*, управо сам на то мислио. Буквално. Ово решење има проблеме.

Баците поглед на ваш пост на енглеском, па онда кликните негде друго. Зашто су ствари на српском? Да ли стварно очекујете да твоји читаоци разуму енглески *и* српски? То делује мало неразумно, зар не бисте рекли? Зашто бисте ставили количину неразумљивих постова до разумљивих блог постова? Зашто вас испитујем као кретен? Ко зна.

Има додатних проблема, као специфичне УРЛ адресе за сваки језик, тагови, и све што може да се локализује. Такозвани „облаци тагова“ које користе више од један језик су ружне и недоступне. Све више је јасније да нам требају неколико сајтова, један за сваки посебан језик, што значи за нас треба нам српска верзија, и енглеска верзија. Идеално би било када би сваки сајт користио исти шаблон, да би делили изглед. Оваква равномерност чини уздисање рељефноста.

Хард кодирање оваквих ствари чини вам ружан код. Много је једноставније да кажемо Хакелу шта заправо хоћемо у дужину трајања. 

``` bash
    $ ./site build sr    # Изгради српску верзију
    $ ./site build en    # Изгради енглеску верзију
``` 

Иако *јесте* ово једноставно, ипак треба да се ручно мења Хакел да би прорадило. Њак. Следеће најбоље решење јесте да користимо варијабле околине свог оперативног система.

``` bash
    $ export TARGET_LANGUAGE='en'
    $ ./site build
```

Након тога, морамо да замотамо ориганлну конфигурацију и да проследимо жељени језик у Хаскелу.

``` haskell
config = defaultConfiguration

main :: IO ()
main = do
    language <- getEnv "TARGET_LANGUAGE"
    hakyllWith config (site language)

site language = 
    ...
```

Морамо и да уверимо да наше `context`е исто разуму језике. Овако, можемо да проследимо језик до самог HTML шаблона и да уживамо. Овде сам звао тај варијабл који служи за то `language`. Знам, знам, креативан сам.

``` haskell
pageCtx :: String -> Context String
pageCtx language = mconcat 
    [ defaultContext
    , constField language language
    ]
```

Са обзиром да користимо статичан генератор, морамо да правимо неке ствари од нуле јер немамо базе. Ствари типа тагови или неке странице које се изгенеришу сваки пут. Најједноставније решење је да направимо `Map`у са кључевима које показују различитих вредности за сваки различитан језик. Нешто овако: 

``` haskell
translations :: Map.Map String (String, String)
translations = Map.fromList [
    ("language", ("English", "Српски"))
    , ("tag_url", ("tag", "таг"))
    , ("name", ("Aleksandar Mićović", "Александар Мићовић"))
    ]
```

И ово можемо да користимо по жељи кроз кода.


### A Job Well Done

Admittedly, most normal people don't want to put in this level of effort just so they can write in a different language. Especially in a static environment, where you actually need to put in a bit of work to get something like this functioning just the way you want it to. Or, they just might not care about separation, but I think the results are worth it.

If you've made it this far, thanks for sticking around. You're currently on the English version of my blog ([aleks.rs](http://aleks.rs)). The Serbian version can be found at [алекс.срб](http://алекс.срб). That's right. I took localization *that* far.

I still consider myself a Haskell newbie, but nevertheless, you can find the source for the entire site in the footer below. It needs a bit of refactoring, but it should paint a better picture of what I'm talking about

I'll be writing from time to time here about lots of stuff, though I tend to prefer technical subjects.

Thanks again for reading!
