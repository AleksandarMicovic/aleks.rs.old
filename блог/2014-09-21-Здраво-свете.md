---
title: Здраво свете!
slug: здраво-свете
created: 2014-09-21
tags: хакел, хаскел
---

### Здраво!
Ових дана само најкул људи користе статичне генераторе за њихове сајтове. И пошто јако желим да будем кул као они, ево решио сам да почнем и ја.

Искрено речено, нешто слично сам користио у прошлости. Неко страшно и неосвештно решење које, укључујући лаганог веб фрејмворка (написан у питону), обичне фајлове у Маркдауну, заједно производило снимак сајта који сам онда аплодавао. Када сам престао са дрогирањем, одлучио сам да тражим нешто што је више разумно.

Нажалост, нисам нашао ништа тако. Заправо нешто горе се десило. Док сам тражио решење, функционална чистоћа ме је обузела, и не постоји ништа горе што штети душвено здравље.

Решио са да пробам [Хакл](http://jaspervdj.be/hakyll/), који је статичан генератор за сајтове написам у Хаскелу, који је чист функционални језик за програмирање. Нисам нешто много користио Хаскела, али морао сам да га научим да конфигуришем [ИКСмонад](http://xmonad.org/) некада давно. Па зашто онда да га не користим на свој блог? Зашто да га не користим за све? Све мора да буде чисто!

...да ли видите сада каква је ово болештина?

Овај пост је само веома кратак преглед мог сајта. Ако сте се играли са статичним генераторима, онда нема ништа ново овде за вас. Али после овог кратког прегледа, показаћу вам како сам решио локализацију, што није баш једноставно ако је цео сајт статичан.

### Обичан статичан сајт

Океј! Једноставне ствари прво. Сваки блог пост је обичан фајл који садржава само текст у Маркдаун формату. Нешто типа овако:

``` markdown
---
title: Здраво свете!
tags: здраво, било шта
---

# Здраво свете!

...итд.

```

Горњи део који је између `---` блокиће је за метадату. Овде можемо буквално да ставимо шта год желимо. Све остало је стандардан Маркдаун. Хакл користи [Пандок](http://freecode.com/projects/pandoc) за рашчлањивање Маркдауна, што значи да уствари имамо надскуп функционалноста Маркдауна. По мени, све што Пандок додатно пружа прави га да има [најбољег верзију Маркдауна](http://johnmacfarlane.net/pandoc/demo/example9/pandocs-markdown.html) икада.

Маркдаун није ни неопходан! Пандок је C-3PO у свет рашчлањивања, тако да можемо било који формат да му дамо и он ће радо да нам избаци правилан HTML. И пошто је C-3PO може и чак Бачи да разуме. 

Сад кад имамо колекцију блог постова, била би добра идеја да нешто урадимо с њима.

``` haskell
main :: IO ()
main = hakyll $ do

    match "images/*" $ do
        route   idRoute
        compile copyFileCompiler

    match "css/*" $ do
        route   idRoute
        compile compressCssCompiler

    match "posts/*" $ do
        route   idRoute
        compile getResourceBody
```

Иако не разумеш Хаскел, ипак можете да расјасните шта се овде дешава.

И наравно, шаблоне се раде исто преко Пандока. На пример, блог пост који смо написали ће наћи себе нагуран у ```$body$``` доле.

``` html
  ...
  <body>
    <div id="content">
      $body$
    </div>
  </body>
  ...
```

Има још пар ствари које повежују све заједно да бисмо имали сајт који ради, и можете читати више о томе [овде](http://jaspervdj.be/hakyll/tutorials/04-compilers.html). Ово је само намеравано да буде кратак преглед за неке основне ствари, али ћу можда једног дана написати неко боље упутство.

...И тако! Елегантно режење које ми даје да се усредсредим на писање уместо дрндањем подешавања.

За ово следеће, ако вас не интересује Хаскел или Хакл, онда слободно затворите језичак и наставите са гледањем мачке.

### Више од једног (људског) језика

Откад сам почео да бринем о функционалној чистоћи утврдили смо да нису ми баш све овце на броју. Што значи да волим да правим проблеме за себе. Имам потпуно луд сан где водим исти овај блог али *потпуно локализован* у сваки језик који говорим. 

...и хоћу да знам много језика.

Хвала Богу да само говорим два за сада: српски и енглески. Тако да овако сам решио овај проблем, у сваком случају ако има још неко ко мисли да водити исти статичан блог у различитим језицима је добра идеја. И као сваки добар пост који помењује Хаскел...!

Пребацили смо се на монадима.

Али прво, морамо да утврдимо да смо сви на истој страници. Прво, компилирамо наш код да добијемо програм `site`:

``` bash
    $ ghc --make site.hs
```

И онда га покренемо да нам изгради сајт:

``` bash
    $ ./site build
```

Ово нам избаци цео извршен сајт у фасциклу која се уобичајено зове `_site`. Једино што нам је остало је да покренемо веб сервер и да му кажемо да служи сајт из те фасцикле. Једноставно, зар не? Како да није! Ово је лепоте статичне генерације.

Међутим, ајде да кажемо да нам се нешто пише на енглеском, и да смо решили да ћемо следећи блог пост да пишемо на енглеском. Нема проблема! Напишемо га и опет покренемо `./site build` и уживамо. И сада на нашем блогу имамо постове на српском и на енглеском. Сјајно. Мада није било потребно јер цео свет разуме српски али 'ајде ми смо светски људи. 

И за многе људе, ово би било прихватљиво решење. Али, чини ми се да сам рекао да смо хтели *потпуно локализован* сајт, што значи да и интерфејс треба да буде енглески.

Опет, нема проблема. Додаћемо променљиву која описује који језик треба да користимо за ту страницу:

``` markdown
---
title: Howdy folks!
language: en
---
```

И у шаблонима, на основу ове променљиве можемо да покажемо исправан језик: 

``` html
  ...
  <a href="/">
    $if(en)$ Home $endif$
    $if(sr)$ Почетна $endif$
  </a>
  ...
```

Све је решено, зар не?

Па није баш. Кад сам рекао *потпуно локализовање*, управо сам на то мислио. Буквално. Ово решење има проблеме.

Баците поглед на ваш пост на енглеском, па онда кликните негде друго. Зашто су ствари на српском? Да ли стварно очекујете да твоји читаоци разуму енглески *и* српски? То делује мало неразумно, зар не бисте рекли? Зашто бисте ставили количину неразумљивих постова до разумљивих? Зашто вас испитујем као кретен?

Има и додатних проблема, као специфичне УРЛ адресе за сваки језик, тагови, и све што може да се локализује. Такозвани „облаци тагова“ које користе више од један језик су ружне и недоступне. Све више је јасније да нам требају неколико сајтова, један за сваки посебан језик, што значи за нас треба нам српска верзија, и енглеска верзија. Идеално би било када би сваки сајт користио исти шаблон, да би делили изглед. Оваква равномерност чини уздисање рељефноста.

Хард кодирање оваквих ствари чини вам ружан код. Много је једноставније да кажемо Хаклу шта заправо хоћемо у дужину трајања. 

``` bash
    $ ./site build sr    # Изгради српску верзију
    $ ./site build en    # Изгради енглеску верзију
``` 

Иако *јесте* ово једноставно, ипак треба да се ручно мења Хакл да би прорадило. Њак. Следеће најбоље решење јесте да користимо променљиве околине свог оперативног система.

``` bash
    $ export TARGET_LANGUAGE='en'
    $ ./site build
```

Након тога, морамо да замотамо ориганлну конфигурацију и да проследимо жељени језик.

``` haskell
config = defaultConfiguration

main :: IO ()
main = do
    language <- getEnv "TARGET_LANGUAGE"
    hakyllWith config (site language)

site language = 
    ...
```

Морамо и да уверимо да наше `context`е исто разуму језике. Овако, можемо да проследимо језик до самог HTML шаблона и да уживамо. Овде сам звао ту променљиву која служи за то `language`. Знам, знам, креативан сам.

``` haskell
pageCtx :: String -> Context String
pageCtx language = mconcat 
    [ defaultContext
    , constField language language
    ]
```

Са обзиром да користимо статичан генератор, морамо да правимо неке ствари од нуле јер немамо базе за дату. Ствари типа тагови или неке странице које се изгенеришу сваки пут. Најједноставније решење је да направимо `Map`у са кључевима које показују различитих вредности за сваки различитан језик. Нешто овако: 

``` haskell
translations :: Map.Map String (String, String)
translations = Map.fromList [
    ("language", ("English", "Српски"))
    , ("tag_url", ("tag", "таг"))
    , ("name", ("Aleksandar Mićović", "Александар Мићовић"))
    ]
```

И ово можемо да користимо по жељи кроз кода.


### То је то

Морам да признам да већину нормалних људи не би оволико труда уложили да би омогућили да воде блог у различитим језицима. Нарочито у статичном оквиру, где заиста треба доста рада да би све радило како вам одговара. Али можда такве људе уопште не занима овакво одвајање, али мислим да резултати говоре сами за себе.

Ако сте дошли довде, хвала вам што сте претрпели. Тренутно читате српску верзију мог блога ([алекс.срб](http://алекс.срб)). Можете посетити енглеску верзију на [aleks.rs](http://aleks.rs). Да, стварно. Локализацију сам протерао *дотле*.

Joш увек сматрам себе њуби кад је у питању Хаскел, али без обзира на то можете наћи извор овог блога у футеру доле. Знам да треба коду неко рефакторисање, али ипак објашњава шта сам тачно хтео и пружа вам целу слику.

Писаћу овде с времена на време о многим стварима, али више волим да причам о техничким темама.

Хвала опет што сте читали!
